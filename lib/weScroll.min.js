!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.WeScroll=i()}(this,function(){"use strict";function t(t,i,e,s){t.addEventListener(i,e,!!s)}function i(t,i,e,s){t.removeEventListener(i,e,!!s)}function e(t,i){var e=document.createEvent("Event");e.initEvent(i,!0,!0),t=t.changedTouches[0]||t,e.pageX=t.pageX,e.pageY=t.pageY,t.target.dispatchEvent(e)}var s=void 0;s="function"!=typeof Object.assign?function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),e=1;e<arguments.length;e++){var s=arguments[e];if(void 0!==s&&null!==s)for(var o in s)s.hasOwnProperty(o)&&(i[o]=s[o])}return i}:Object.assign;var o=s,n="ontouchstart"in window,r=!(!window.PointerEvent&&!window.MSPointerEvent),h={quadratic:function(t){return t*(2-t)},circular:function(t){return Math.sqrt(1- --t*t)},back:function(t){return(t-=1)*t*(5*t+4)+1},bounce:function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},elastic:function(t){return 0===t?0:1===t?1:.4*Math.pow(2,-10*t)*Math.sin((t-.055)*(2*Math.PI)/.22)+1}},a=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},c=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),u=function(){function t(t,i){var e=[],s=!0,o=!1,n=void 0;try{for(var r,h=t[Symbol.iterator]();!(s=(r=h.next()).done)&&(e.push(r.value),!i||e.length!==i);s=!0);}catch(t){o=!0,n=t}finally{try{!s&&h.return&&h.return()}finally{if(o)throw n}}return e}return function(i,e){if(Array.isArray(i))return i;if(Symbol.iterator in Object(i))return t(i,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function t(){a(this,t),this._events=[]}return c(t,[{key:"on",value:function(t,i){this._events[t]||(this._events[t]=[]),this._events[t].push(i)}},{key:"off",value:function(t,i){if(this._events[t]){var e=this._events[t].indexOf(i);e>-1&&this._events[t].splice(e,1)}}},{key:"trigger",value:function(t){if(this._events[t]){var i=0,e=this._events[t].length;if(e)for(;i<e;i++)this._events[t][i].apply(this,[].slice.call(arguments,1))}}}]),t}(),p=function(t){for(var i=-t.offsetLeft,e=-t.offsetTop;t=t.offsetParent;)i-=t.offsetLeft,e-=t.offsetTop;return{left:i,top:e}},d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},f={zoomMin:1,zoomMax:4,startZoom:1,disablePointer:!r,disableTouch:r||!n,disableMouse:r||n,startX:0,startY:0,directionLockThreshold:5,margin:0,bounce:!0,bounceTime:480,duration:300,preventDefault:!0,bindToWrapper:!0};return function(){function s(t,i){a(this,s),this.wrapper="string"==typeof t?document.querySelector(t):t,this.options=o({},f,i),this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault;var e=this.options.margin;this.options.marginTop=this.options.marginTop||e,this.options.marginBottom=this.options.marginBottom||e,this.options.marginLeft=this.options.marginLeft||e,this.options.marginRight=this.options.marginRight||e,!0===this.options.tap&&(this.options.tap="tap"),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this.scale=Math.min(Math.max(this.options.startZoom,this.options.zoomMin),this.options.zoomMax),this._init(),this.refresh(),this._scrollTo(this.options.startX,this.options.startY),this.enable(),this._ticking=!1}return c(s,[{key:"_init",value:function(){this.observer=new l,this._initEvents()}},{key:"destroy",value:function(){this._initEvents(!0),clearTimeout(this.resizeTimeout),this.resizeTimeout=null,this.observer.trigger("destroy")}},{key:"_start",value:function(t){if(!this._ticking&&this.enabled){this.options.preventDefault&&t.preventDefault();var i=t.touches?t.touches[0]:t;this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this.startTime=Date.now(),this.isAnimating&&(this.isAnimating=!1,this.observer.trigger("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=i.pageX,this.pointY=i.pageY,this.observer.trigger("beforeScrollStart")}}},{key:"_move",value:function(t){if(this.enabled&&!this._ticking){this.options.preventDefault&&t.preventDefault();var i=t.touches?t.touches[0]:t,e=i.pageX-this.pointX,s=i.pageY-this.pointY,o=Date.now(),n=void 0,r=void 0,h=void 0,a=void 0;this.pointX=i.pageX,this.pointY=i.pageY,this.distX+=e,this.distY+=s,h=Math.abs(this.distX),a=Math.abs(this.distY),o-this.endTime>300&&h<10&&a<10||(this.directionLocked||(h>a+this.options.directionLockThreshold?this.directionLocked="h":a>=h+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"===this.directionLocked?s=0:"v"===this.directionLocked&&(e=0),n=this.x+e,r=this.y+s,(n>0||n<this.maxScrollX)&&(n=this.options.bounce?this.x+e/3:n>0?0:this.maxScrollX),(r>0||r<this.maxScrollY)&&(r=this.options.bounce?this.y+s/3:r>0?0:this.maxScrollY),this.directionX=e>0?-1:e<0?1:0,this.directionY=s>0?-1:s<0?1:0,this.moved||this.observer.trigger("scrollStart"),o-this.startTime>300&&(this.startTime=o,this.startX=this.x,this.startY=this.y),this._render(n,r),this.moved=!0)}}},{key:"_end",value:function(t){if(!this._ticking&&this.enabled){this.options.preventDefault&&t.preventDefault();var i=Math.round(this.x),s=Math.round(this.y),o="";if(this.endTime=Date.now(),!this.resetPosition(this.options.bounceTime))return this._scrollTo(i,s),this.moved?i!==this.x||s!==this.y?((i>this.options.marginLeft||i<this.maxScrollX||s>this.options.marginTop||s<this.maxScrollY)&&(o=h.quadratic),void this._scrollTo(i,s,0,o)):void this.observer.trigger("scrollEnd"):(this.options.tap&&e(t,this.options.tap),void this.observer.trigger("scrollCancel"))}}},{key:"_resize",value:function(){var t=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){t.refresh()},this.options.resizePolling)}},{key:"_adjustPosition",value:function(t,i){var e=t,s=i;return e>this.options.marginLeft?e=this.options.marginLeft:e<this.maxScrollX&&(e=this.maxScrollX),s>this.options.marginTop?s=this.options.marginTop:s<this.maxScrollY&&(s=this.maxScrollY),[e,s]}},{key:"resetPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=this._adjustPosition(this.x,this.y),e=u(i,2),s=e[0],o=e[1];return(s!==this.x||o!==this.y)&&(this._scrollTo(s,o,t,h.circular),!0)}},{key:"disable",value:function(){this.enabled=!1}},{key:"enable",value:function(){this.enabled=!0}},{key:"refresh",value:function(){this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=Math.round(this.options.contentWidth*this.scale),this.scrollerHeight=Math.round(this.options.contentHeight*this.scale),this.maxScrollX=this.wrapperWidth-this.scrollerWidth-this.options.marginRight,this.maxScrollY=Math.min(this.options.marginTop,this.wrapperHeight-this.scrollerHeight-this.options.marginBottom),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=p(this.wrapper),this.observer.trigger("refresh")}},{key:"_render",value:function(t,i){if(!this._ticking){var e=function(){this.options.render(t,i,this.scale),this.x=t,this.y=i,this._ticking=!1};if(!this._ticking){var s=e.bind(this);d(s),this._ticking=!0}}}},{key:"_zoomStart",value:function(t){var i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),e=Math.abs(t.touches[0].pageY-t.touches[1].pageY);this.touchesDistanceStart=Math.sqrt(i*i+e*e),this.startScale=this.scale,this.originX=Math.abs(t.touches[0].pageX+t.touches[1].pageX)/2+this.wrapperOffset.left-this.x,this.originY=Math.abs(t.touches[0].pageY+t.touches[1].pageY)/2+this.wrapperOffset.top-this.y,this.observer.trigger("zoomStart")}},{key:"_zoom",value:function(t){if(this.enabled){this.options.preventDefault&&t.preventDefault();var i=Math.abs(t.touches[0].pageX-t.touches[1].pageX),e=Math.abs(t.touches[0].pageY-t.touches[1].pageY),s=Math.sqrt(i*i+e*e),o=1/this.touchesDistanceStart*s*this.startScale,n=void 0,r=void 0,h=void 0;this.scaled=!0,o<this.options.zoomMin?o=.5*this.options.zoomMin*Math.pow(2,o/this.options.zoomMin):o>this.options.zoomMax&&(o=2*this.options.zoomMax*Math.pow(.5,this.options.zoomMax/o)),n=o/this.startScale,r=this.originX-this.originX*n+this.startX,h=this.originY-this.originY*n+this.startY,this.scale=o,this._scrollTo(r,h,0)}}},{key:"_zoomEnd",value:function(t){if(this.enabled){this.options.preventDefault&&t.preventDefault(),this.initiated=0,this.scale>this.options.zoomMax?this.scale=this.options.zoomMax:this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin),this.refresh();var i=this.scale/this.startScale,e=this.originX-this.originX*i+this.startX,s=this.originY-this.originY*i+this.startY,o=this._adjustPosition(e,s),n=u(o,2),r=n[0],h=n[1];this.x===r&&this.y===h||this._scrollTo(r,h,this.options.bounceTime),this.scaled=!1,this.observer.trigger("zoomEnd")}}},{key:"_getDestinationPosition",value:function(t,i){var e=void 0===t?this.scrollerWidth/2:t*this.scale,s=void 0===i?this.scrollerHeight/2:i*this.scale;e=this.wrapperWidth/2-e,s=this.wrapperHeight/2-s;var o=this._adjustPosition(e,s),n=u(o,2);return{x:n[0],y:n[1]}}},{key:"_animate",value:function(t,i,e,s){function o(){var u=Date.now(),l=void 0,p=void 0,f=void 0;if(u>=c)return n.isAnimating=!1,void n._render(t,i);u=(u-a)/e,f=s(u),l=(t-r)*f+r,p=(i-h)*f+h,n._render(l,p),n.isAnimating&&d(o)}var n=this,r=this.x,h=this.y,a=Date.now(),c=a+e;this.isAnimating=!0,o()}},{key:"_scrollTo",value:function(t,i,e,s){s=s||h.circular,e?this._animate(t,i,e,s):this._render(t,i)}},{key:"scrollTo",value:function(t,i,e,s){e=void 0===e?this.options.duration:e,s=s||h.circular,t=-t*this.scale+this.wrapperWidth/2,i=-i*this.scale+this.wrapperHeight/2;var o=this._adjustPosition(t,i),n=u(o,2),r=n[0],a=n[1];this._scrollTo(r,a,e,s)}},{key:"zoom",value:function(t,i,e,s){function o(){var h=Date.now(),l=void 0,p=void 0,f=void 0,v=void 0;if(h>=c)return n.isAnimating=!1,n.scale=t,n.refresh(),f=n._getDestinationPosition(i,e),void n._render(f.x,f.y);h=(h-a)/s,v=u(h),p=(t-r)*v+r,n.scale=p,n.refresh(),l=n._getDestinationPosition(i,e),n._render(l.x,l.y),n.isAnimating&&d(o)}if(t<this.options.zoomMin?t=this.options.zoomMin:t>this.options.zoomMax&&(t=this.options.zoomMax),t!==this.scale){s=void 0===s?300:s;var n=this,r=n.scale,a=Date.now(),c=a+s,u=h.circular;this.isAnimating=!0,o()}}},{key:"_initEvents",value:function(e){var s=e?i:t,o=this.options.bindToWrapper?this.wrapper:window,r=this._handleEvent.bind(this);if(s(window,"resize",r),this.options.click&&s(this.wrapper,"click",r,!0),!this.options.disableMouse){s(this.wrapper,"mousedown",r);["mousemove","mousecancel","mouseup"].forEach(function(t){s(o,t,r)})}if(n&&!this.options.disableTouch){s(this.wrapper,"touchstart",r);["touchmove","touchcancel","touchend"].forEach(function(t){s(o,t,r)})}}},{key:"_handleEvent",value:function(t){switch(t.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(t),this.options.zoom&&t.touches&&t.touches.length>1&&this._zoomStart(t);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":if(this.options.zoom&&t.touches&&t.touches[1])return void this._zoom(t);this._move(t);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":if(this.scaled)return void this._zoomEnd(t);this._end(t);break;case"orientationchange":case"resize":this._resize()}}}]),s}()});
